<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>React</title>
    <script type="text/javascript" src="../build/react.js"></script>
    <script type="text/javascript" src="../build/JSXTransformer.js"></script>
</head>
<body>
<script type="text/jsx">
    var Divider = React.createClass({
        render: function () {
            return <div className="driver">
                <hr />
            </div>
        }
    });

    var DraggableQuestions = React.createClass({
        render: function () {
            return (
                    <ul className="modules list-unstyled">
                        <li>
                            <ModuleButton text='Yes / No' questionType='yes_no'/>
                        </li>
                        <li>
                            <ModuleButton text='Multiple choice' questionType='multiple_choice'/>
                        </li>
                        <li>
                            <ModuleButton text='Essay' questionType='essay'/>
                        </li>
                    </ul>
            );
        },

        shouldComponentUpdate: function () {
            return false;
        }
    });

    var SurveyForm = React.createClass({
        propTypes: {
            title: React.PropTypes.string.isRequired,
            introduction: React.PropTypes.string.isRequired
        },

        render: function () {
            return (
                    <div>
                        <h2>Title</h2>
                        <input
                                className='title'
                                type='text'
                                value={this.props.title}
                                onChange={this.handleTitleChange}/>

                        <h2>Introduction</h2>
                        <textarea
                                className='introduction'
                                value={this.props.introduction}
                                onChange={this.handleIntroductionChange}/>
                    </div>
            );
        },

        handleTitleChange: function (ev) {
            this.props.onChange({title: ev.target.value});
        },

        handleIntroductionChange: function (ev) {
            this.props.onChange({introduction: ev.target.value});
        }
    });

    var SurveyEditor = React.createClass({
        getInitialState: function () {
            return {
                dropZoneEntered: false,
                title: '',
                introduction: '',
                questions: []
            };
        },
        render: function () {
            var questions = this.state.questions;

            var dropZoneEntered = '';
            if (this.state.dropZoneEntered) {
                dropZoneEntered = 'drag-enter';
            }

            return (
                    <div className="survey-editor">
                        <div className="row">
                            <aside className="sidebar col-md-3">
                                <h2>Modules</h2>
                                <DraggableQuestions />
                            </aside>

                            <div className="survey-canvas col-md-9">
                                <SurveyForm
                                        title={this.state.title}
                                        introduction={this.state.introduction}
                                        onChange={this.handleFormChange}
                                        />

                                <Divider>Questions</Divider>
                                <ReactCSSTransitionGroup transitionName="question">
                                    {questions}
                                </ReactCSSTransitionGroup>

                                <div
                                        className={'drop-zone well well-drop-zone'+dropZoneEntered}
                                        onDragOver={this.handleDragOver}
                                        onDragEnter={this.handleDragEnter}
                                        onDragLeave={this.handleDragLeave}
                                        onDrop={this.handleDrop}
                                        >
                                    Drag and drop a module from the left
                                </div>

                                <div className="'actions">
                                    <button className="btn btn-save" onClick={this.handleSaveClicked}>
                                        save
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
            );
        },
        handleFormChange: function (formData) {
            this.setState(formData);
        },

        handleDragOver: function (ev) {
            ev.preventDefault();
        },
        handleDragEnter: function () {
            this.setState({dropZoneEntered: true});
        },
        handleDragLeave: function () {
            this.setState({dropZoneEntered: false});
        },
        handleDrop: function (ev) {
            var questionType = ev.dataTransfer.getData('questionType');
            var questions = this.state.questions;
            questions = questions.concat({type: questionType});
            this.setState({
                questions: questions,
                dropZoneEntered: false
            });
        }
    });
    React.render(<SurveyEditor />, document.body);
</script>
</body>
</html>